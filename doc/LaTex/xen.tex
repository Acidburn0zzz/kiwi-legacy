\index{KIWI images!xen|(}
\chapter{Xen Image---Paravirtual Systems}
\label{chapter:xen}
\minitoc

Xen is a free software virtual machine monitor. It allows several
guest operating systems to be executed on the same computer hardware
at the same time.

A Xen system is structured with the Xen hypervisor as the lowest and
most privileged layer.%[1] %% <-- Should this be a reference?
Above this layer are one or more guest
operating systems, which the hypervisor schedules across the physical
CPUs. The first guest operating system, called in Xen terminology
\kquote{domain 0} (dom0), is booted automatically when the hypervisor boots
and given special management privileges and direct access to the physical
hardware. The system administrator logs into dom0 in order to start
any further guest operating systems, called \kquote{domain U} (domU) in
Xen terminology.

A xen image is a virtual disk like a vmx but with the xen kernel
installed. In order to run it a Xen dom0 server needs to run. Xen
images in kiwi makes use of the PVGrub method supported by current
Xen versions. Xen extracts the kernel and initrd from the virtual
disk as well as the grub configuration and displays the menu which
allows emulation of the grub console

\section{Building the suse-xen-guest Example}

The latest example provided with kiwi is based on openSUSE 11.3 and includes
the base pattern. 

\begin{Command}{12cm}
\begin{verbatim}
cd /usr/share/doc/packages/kiwi/examples
cd suse-11.2
kiwi --prepare ./suse-xen-guest \
     --root /tmp/myxen
\end{verbatim}
\end{Command}

\begin{Command}{12cm}
\begin{verbatim}
kiwi --create /tmp/myxen \
     --type vmx -d /tmp/myxen-result
\end{verbatim}
\end{Command}

\section{Using the Image}

In order to run a domain U the Xen tool \cmd{xm} needs to be called
in conjunction with the KIWI genereated domain U configuration file

\begin{Command}{13cm}
\begin{verbatim}
xm create -c \
   /tmp/myxen-result/\
   suse-11.2-xen-guest.i686-1.1.2.xenconfig
\end{verbatim}
\end{Command}

\section{Flavours}

With KIWI you can provide the information
required to create a guest configuration as part of the config.xml
file. Additionally you can group special packages which you may only
need in this para virtual environment with a profile.

\begin{Command}{13cm}
\begin{verbatim}
<packages type="image" profiles="xenFlavour">
   <package name="kernel-xen" replaces="kernel-ec2"/>
</packages>
<type ....>
   <machine memory="512" domain="domU">
      <vmdisk ... device="/dev/xvda"/>
   </machine>
</type>
\end{verbatim}
\end{Command}

If this information is present KIWI will create a Xen domain U
configuration with 512 MB of RAM and expects the disk at \path{/dev/xvda}.
Additional information to setup the Xen guest machine properties are
explained in the \texttt{machine} section. The KIWI Xen domain U
configuration is stored in the file:

\begin{Command}{13cm}
\begin{verbatim}
/tmp/myxen-result/\
    suse-11.2-xen-guest.i686-1.1.2.xenconfig
\end{verbatim}
\end{Command}
