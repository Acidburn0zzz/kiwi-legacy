\index{KIWI images!vmx|(}
\chapter{VMX image - Virtual Disks}
\label{chapter:vmx}
\minitoc

A VMX image is a virtual disk image for use in full virtualisation
systems like QEMU or VMware. The image is a file containing the
system represented by the configured packages in config.xml as well
as partition data and bootloader information. The size of
this virtual disk can be specified by using the <size> element
in the config.xml file or by adding the $--$bootvm-disksize command
line argument.

\section{Building the suse-vm-guest example}

The vm-guest example provided with kiwi is based on recent openSUSE releases,
one example configuration per release. The example uses base pattern and the
virtual disk is formated using the distribution default filesystem.

\begin{Command}{12cm}
\begin{verbatim}
cd /usr/share/doc/packages/kiwi/examples
cd suse-11.2
kiwi --prepare ./suse-vm-guest \
     --root /tmp/myvm
\end{verbatim}
\end{Command}

\begin{Command}{12cm}
\begin{verbatim}
kiwi --create /tmp/myvm \
     --type vmx -d /tmp/myvm-result
\end{verbatim}
\end{Command}

\section{Using the image}

The generated virtual disk image serves as the hard disk of the selected
virtualization system (QEMU, VMware, etc.). The virtual hard disk format 
differs across virtualization environments. Some virtualization environments
support multiple virtual disk formats. Using the QEMU virtualization 
environment the created image may be tested with the following command:

\begin{Command}{12cm}
\begin{verbatim}
cd /tmp/myvm-result
qemu suse-11.2-vm-guest.i686-1.1.2.raw -m 256
\end{verbatim}
\end{Command}

\section{Flavours}

Kiwi always generates a file in the .raw format. The .raw file is a disk
image with a structure equivalent to the structure of a physical hard disk. 
Individual virtualization systems have specific formats to facilitate
improved I/O performance to the virtual disk, represented by the image file,
or additional specified virtual hard disk files. Kiwi will generate a 
specific format when the format attribute of the type element is specified.


\begin{Command}{12cm}
\begin{verbatim}
<type image=''vmx''... format=''name''/>
\end{verbatim}
\end{Command}

The following table lists the supported virtual disk formats

\begin{tabular}[h]{|p{2cm}|p{9cm}|}
\hline
\textbf{Name} & \textbf{Description} \\
\hline
vvfat       & Disk format DOS FAT32 \\
vpc         & Virtual PC read only disk  \\
bochs       & Disk format for Bochs emulator  \\
dmg         & Disk format for Mac OS X \\
cloop       & Compressed loop \\
vmdk        & Disk format for VMware \\
ovf         & Open Virtual Format requires VMwares ovftool \\
qcow2       & QEMU virtual disk format  \\
qcow        & QEMU virtual disk format  \\
cow         & QEMU virtual disk format \\
\hline
\end{tabular}

\subsection{VMware support}

A VMware image is accompanied by a guest configuration file. This file 
includes information about the hardware to be represented to the guest 
image by the VMware virtualization environment as well as specification
of resources such as memory. 

Within the config.xml file it is possible to specify the VMware configuration
settings. In addition it is possible to include selected packages in the 
created image that are specific to the VMware image generation. The following
config.xml snippet provides general guidance on the elements in config.xml.

\begin{Command}{13cm}
\begin{verbatim}
<packages type="vmware">
   <!-- packages you need in VMware only -->
</packages>
<type......>
   <vmwareconfig memory="512">
      <vmwaredisk controller="ide" id="0"/>
   </vmwareconfig>
</type>
\end{verbatim}
\end{Command}

Given the specification above Kiwi will create a VMware guest
configuration specifying the availability of 512 MB of RAM and an IDE 
disk controller interface for the VM guest. For aditional information
about the configuration settings please refere to the 
\textbf{vmwareconfig} section. 

The guest configuration can be loaded through VMware user interface and 
may be modified through the GUI. The configuration file has the .vmx 
extension as shown in the example below.

\begin{Command}{13cm}
\begin{verbatim}
/tmp/myvm-result/suse-11.2-vm-guest.i686-1.1.2.vmx
\end{verbatim}
\end{Command}

Using the \textbf{format=''vmdk''} attribute of the <type> element
will create the VMware formated disk image (.vmdk file) and the required 
VMware guest configuration (.vmx) file.

In addition it is possible to create an image for the Xen virtualization 
framework.  By adding the \textbf{bootprofile} and \textbf{bootkernel} 
attributes to the <type> element with values of 'xen' and 'xenboot', 
respectively. Please refer to the \ref{chapter:xen} (Xen image) chapter 
for additional details.

\subsection{LVM support}

Kiwi also provides support for LVM (Logical Volume Management). In this
mode the disk partition table will include one lvm partition and one
standard ext2 boot partition. Kiwi creates the kiwiVG volume group and
adds logical volumes as they are needed and configured according to the
image type and filesystem. After boot of the system the user has full
control over the volume group and is free to change/resize/increas the
group and the volumes inside. Support for LVM has been added for all
image types which are disk based. This includes vmx,oem and usb.
In order to use LVM for the vmx type just add the \verb+--lvm+ option
as part of the Kiwi create step or add the attribute \textbf{lvm=''true''}
as part of the \textbf{type} section in your config.xml file.

\begin{Command}{12cm}
\begin{verbatim}
kiwi --create /tmp/myvm --type vmx \
     -d /tmp/myvm-result --lvm
\end{verbatim}
\end{Command}

With the optional \textbf{lvmvolumes} section you can set one or
more top level directories into a separate volume. See the
\textit{KIWI image description} chapter for a detailed explanation.
