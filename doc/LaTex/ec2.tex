\index{KIWI images!ec2|(}
\chapter{EC2 image - Amazon Elastic Compute Cloud}
\label{chapter:ec2}
\minitoc

%1) read documentation how to setup an Account for AWS and the EC2 service
%   http://docs.amazonwebservices.com/AmazonEC2/gsg/2006-06-26/
%
%2) setup the example image doc/examples/suse-xen-guest for ec2
%   make sure the config.sh includes the line
%  
%       suseCloneRunlevel 4
%
%   this is required on Amazon because it runs in runlevel 4 which
%   is not used at all on suse systems
%
%  <type ec2accountnr="720220196365"
%        ec2privatekeyfile="/suse/ms/.ec2/pk-cambrian-aws.pem"
%        ec2certfile="/suse/ms/.ec2/cert-cambrian-aws.pem"
%        boot="xenboot/suse-11.0"
%  >ec2</type>
%
%  boot attribute makes only sense if you are an Amazon partner and
%  allowed to create and upload Amazon kernel and initrd images. If
%  not the kiwi create step will fail
%
%  ec2privatekeyfile: AWS user's PEM encoded RSA private key file
%  ec2accountnr: The user's EC2 user ID (Note: AWS account number, NOT Access Key ID)
%  ec2certfile: AWS user's PEM encoded RSA pubkey certificate file
%
%3) prepare and create the image 
%
%4) The generated image must be transfered over to Amazon which is
%   done by ec2-upload-bundle.
%
%   with boot image and kernel
%
%   ec2-upload-bundle -b suse -a <AWS Key ID> -s <AWS secret Key ID> \
%    -m /tmp/mytest/<initrd>.ari.manifest.xml     
%
%   ec2-upload-bundle -b suse -a <AWS Key ID> -s <AWS secret Key ID> \
%    -m /tmp/mytest/<initrd.kernel>.aki.manifest.xml
% 
%   the system image
%
%   ec2-upload-bundle -b suse -a <AWS Key ID> -s <AWS secret Key ID> \
%	-m /tmp/mytest/<image>.ami.manifest.xml 
%
%5) Register the uploaded images
%
%   with boot image and kernel
%
%   ec2-register suse/<initrd>.ari.manifest.xml
%   ec2-register suse/<initrd.kernel>.aki.manifest.xml
%
%   the system image
%
%   ec2-register suse/<image>.ami.manifest.xml
%
%   Each registration provides an identifier which is an ami-... for the system
%   image an aki-... for the kernel image and an ari-... for the initrd image.
%   If you are not able to build and upload kernel/initrd images you need to
%   select an appropriate one provided by Amazon. This can be done checking
%   the list with
%  
%   ec2-describe-images -a
%
%6) Run an ec2 instance
%
%   ec2-add-keypair ms-gsg-keypair
%   The private key returned needs to be saved in a local file so that you can use it later.
%   Using your favorite text editor, create a file named id_rsa-ms-gsg-keypair and paste everything between
%   (and including) the "-----BEGIN RSA PRIVATE KEY-----" and "-----END RSA PRIVATE KEY-----" lines into it.
%
%   ec2-describe-keypairs
%
%   ec2-run-instances ami-... --kernel aki-... --ramdisk ari-.... -k ms-gsg-keypair
%   ec2-describe-instances
%
%   ec2-authorize default -p 22
